!function(){"use strict";var e,t,r;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(e||(e={})),function(e){e.EventEmpty="Empty Event",e.EventUnexpected="Unexpected Event",e.MonitorCallError="Monitor Call Error",e.MonitorCreateError="Monitor Creation Error",e.MonitorDuplicateProp="Monitor Duplicate Property",e.MonitorEmitError="Monitor Emit Error",e.MonitorRemoveError="Monitor Removal Error",e.OperatorError="Operator Error",e.ObserverMultipleLoad="Duplicate Observer",e.ObserverReadError="Read Error",e.ObserverRulesNone="No Rules Defined",e.RuleInvalid="Invalid Rule",e.RuleRegistrationError="Rule Registration Error",e.ObserverInitializationError="Observer Initialization Error"}(t||(t={})),function(e){e.DataLayerMissing="Data layer not found",e.DuplicateValue="Value $0 already used",e.ShimFail="Shim not allowed because object is $0",e.SelectorInvalidIndex="Selector index $0 is not a number in $1",e.SelectorIncorrectTokenCount="Selector has incorrect number ($0) of tokens in $1",e.SelectorMalformed="Selector $0 is malformed",e.SelectorMissingToken="Selector is missing $0 in $1",e.SelectorNoProps="Selector is missing properties",e.SelectorSyntaxUnsupported="Selector syntax $0 is unsupported",e.TargetSubjectObject="Target subject must be an object",e.TargetPropertyMissing="Target property is missing",e.TargetPathMissing="Target path is missing",e.UnknownValue="Unknown value $0",e.UnsupportedType="Unsupported type $0"}(r||(r={}));var n=function(){function t(){}return t.prototype.log=function(t){var r=t.context,n=t.level,o=t.message+(r?" "+JSON.stringify(r):"");switch(n){case e.ERROR:return console.error(o);case e.WARN:return console.warn(o);case e.INFO:return console.info(o);case e.DEBUG:default:return console.debug(o)}},t}(),o=function(){function e(){this.timeoutId=null}return e.prototype.log=function(t){var r=this,n=window[window._fs_namespace];if(n){var o=t.context,i=t.level,s=t.message,a=o?{level_int:i,message:s,context:o}:{level_int:i,message:s};this.isDuplicate(t)?("number"==typeof this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((function(){r.timeoutId=null,n.event("Data Layer Observer",a,"dlo-log")}),e.debounceTime)):n.event("Data Layer Observer",a,"dlo-log"),this.prevEvent=t}},e.prototype.isDuplicate=function(e){var t=e.context,r=e.message;if(!this.prevEvent||!t||!this.prevEvent.context)return!1;var n=t.source,o=t.reason,i=this.prevEvent,s=i.message,a=i.context,u=a.source,c=a.reason;return r===s&&n===u&&o===c},e.debounceTime=250,e}(),i=function(){function t(e){switch(void 0===e&&(e="console"),this.level=1,e){case"fullstory":this.appender=new o;break;case"console":default:this.appender=new n}}return t.format=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=e,o=0;o<t.length;o+=1)n=n.replace("$"+o,t[o]);return n.trim()},t.getInstance=function(e){return t.instance||(t.instance=new t(e)),t.instance},t.prototype.log=function(e,t,r){e<=this.level&&this.appender.log({level:e,message:t,context:r})},t.prototype.error=function(t,r){this.log(e.ERROR,t,r)},t.prototype.warn=function(t,r){this.log(e.WARN,t,r)},t.prototype.info=function(t,r){this.log(e.INFO,t,r)},t.prototype.debug=function(t,r){this.log(e.DEBUG,t,r)},t}();function s(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}function a(e,t,r){var n=0;return r&&r>0&&(n=r),e.indexOf(t,n)===n}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};var c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},p=function(){function e(e){if(this.options=e,!e.name)throw new Error("Operator options "+JSON.stringify(e)+" has no name")}return e.prototype.checkRequired=function(e){void 0===this.options[e]&&this.throwError(e,"is required")},e.prototype.checkType=function(e,t){-1===t.toString().toLowerCase().indexOf(typeof this.options[e])&&this.throwError(e,"is a "+typeof this.options[e]+" but should be "+t)},e.prototype.checkDependencies=function(e,t){var r=this;t.forEach((function(t){void 0===r.options[t]&&r.throwError(e,"requires option "+t)}))},e.prototype.throwError=function(e,t){throw new Error("Operator '"+this.options.name+"' option '"+e+"' "+t)},e.isReservedProperty=function(e){return"name"===e||"index"===e||"maxDepth"===e},e.prototype.validate=function(t){var r=this,n=this.options.name;Object.getOwnPropertyNames(t).forEach((function(e){var n=t[e],o=n.required,i=n.type,s=n.dependencies,a=void 0===s?[]:s;o&&r.checkRequired(e),r.options[e]&&(r.checkType(e,i),r.checkDependencies(e,a))})),Object.getOwnPropertyNames(this.options).filter((function(t){return!e.isReservedProperty(t)})).forEach((function(e){if(!t[e])throw Error("Operator '"+n+"' has unknown option "+e)}))},e}();function l(e,t,r){var n=e.slice();return n.splice(t,1,r),n}var h,f=function(){function e(e){this.options=e;var t=e.index,r=void 0===t?0:t;this.index=r}return e.convert=function(t,r){switch(t){case"bool":return"true"===r||"TRUE"===r||"True"===r;case"date":return new Date(r);case"int":case"real":return r?e.enumerate(r):0;case"string":switch(typeof r){case"boolean":return Boolean(r).toString();case"number":return r.toString();case"undefined":return"";default:return null===r?"":r}default:return r}},e.enumerate=function(e){var t=parseFloat(e);return isNaN(e)||Number.isNaN(t)?NaN:t},e.enumerableProperties=function(e){return Object.getOwnPropertyNames(e).filter((function(t){return"string"==typeof e[t]||Array.isArray(e[t])&&"string"==typeof e[t][0]}))},e.prototype.handleData=function(t){var r=this.index>=0?this.index:t.length+this.index,n=this.options,o=n.properties,i=n.ignore,s=this.options,a=s.enumerate,u=s.force,p=s.preserveArray,h=s.type;"string"==typeof o&&(o=o.split(",").map((function(e){return e.trim()}))),"string"==typeof i&&(i=i.split(",").map((function(e){return e.trim()})));var f=c({},t[r]);if(a){var d=e.enumerableProperties(t[r]);if(i){d=d.filter((function(e){return!(null==i?void 0:i.includes(e))}))}d.forEach((function(n){if("string"==typeof t[r][n])""!==t[r][n]&&(f[n]=e.convert("real",t[r][n]),e.verifyConversion("real",n,f,t[r]));else{f[n]=[];for(var o=0;o<t[r][n].length;o+=1)f[n].push(e.convert("real",t[r][n][o]));e.verifyConversion("real",n,f,t[r])}}))}o&&h&&("*"===o[0]?Object.getOwnPropertyNames(t[r]):o).forEach((function(n){var o=t[r][n];if(null!=o||u)if(Array.isArray(o)){f[n]=[];for(var i=0;i<o.length;i+=1){var s=o[i];f[n].push(e.convert(h,s))}e.verifyConversion(h,n,f,t[r])}else f[n]=e.convert(h,o),e.verifyConversion(h,n,f,t[r])}));return p||Object.getOwnPropertyNames(f).forEach((function(e){if(Array.isArray(f[e])&&1===f[e].length){var t=f[e][0];f[e]=t}})),l(t,r,f)},e.prototype.validate=function(){var t=new p(this.options);t.validate(e.specification);var r=this.options,n=r.enumerate,o=r.force,i=r.properties,s=r.type;if(void 0===n&&void 0===i)throw t.throwError("properties","must be specified if 'enumerate' is undefined and vice versa");if(void 0!==n&&"boolean"!=typeof n)throw t.throwError("enumerate","should be a boolean");if(void 0!==o&&"boolean"!=typeof o)throw t.throwError("force","should be a boolean");if(void 0!==o&&o&&"date"===s)throw t.throwError("force","can not forcibly convert dates");if(void 0!==i&&!s)throw t.throwError("type","must be declared when using 'properties'");if(s&&"bool"!==s&&"int"!==s&&"real"!==s&&"string"!==s&&"date"!==s)throw t.throwError("type","unknown type '"+s+"' used")},e.verifyConversion=function(e,r,n,o){var s=n[r],a=o[r],u=!0;"int"!==e&&"real"!==e||(u=Array.isArray(s)?s.every((function(e){return!Number.isNaN(e)})):!Number.isNaN(s)),"date"===e&&(u=Array.isArray(s)?s.every((function(e){return!Number.isNaN(e.getTime())})):!Number.isNaN(s.getTime())),u||(n[r]=a,i.getInstance().debug(t.OperatorError,{operator:"convert",property:r.toString(),reason:"Failed to convert to "+e+" for value "+a}))},e.specification={enumerate:{required:!1,type:["boolean"]},force:{required:!1,type:["boolean"]},index:{required:!1,type:["number"]},preserveArray:{required:!1,type:["boolean"]},properties:{required:!1,type:["string,object"]},type:{required:!1,type:["string"]},ignore:{required:!1,type:["string,object"]}},e}(),d=function(){function e(e){this.options=e;var t=e.index,r=void 0===t?0:t,n=e.maxDepth,o=void 0===n?10:n;this.index=r,this.maxDepth=o}return e.prototype.flattenHelper=function(e,t,r){var n=this;void 0===r&&(r=0),Object.getOwnPropertyNames(t).forEach((function(o){"object"==typeof t[o]&&null!=t[o]&&!Array.isArray(t[o])&&r<n.maxDepth+1?n.flattenHelper(e,t[o],r+1):e[o]=t[o]}))},e.prototype.handleData=function(e){var t={},r=e[this.index];return this.flattenHelper(t,r),l(e,this.index,t)},e.prototype.validate=function(){new p(this.options).validate(e.specification)},e.specification={index:{required:!1,type:["number"]},maxDepth:{required:!1,type:["number"]}},e}(),v={};!function(e){e.Pluck="pluck",e.Index="index",e.Pick="pick",e.Omit="omit",e.Prefix="prefix",e.Suffix="suffix",e.Filter="filter"}(h||(h={}));var y,g={pluck:function(e){return!1===e.includes("[")&&!1===e.includes("(")},index:function(e){return/.+\[-?\d+\]$/.test(e)},pick:function(e){return/.+\[\(.*\)\]$/.test(e)},omit:function(e){return/.+\[!\(.*\)\]$/.test(e)},prefix:function(e){return/.+\[\^\(.*\)\]$/.test(e)},suffix:function(e){return/.+\[\$\(.*\)\]$/.test(e)},filter:function(e){return/.+\[\?\(.*\)\]$/.test(e)}};!function(e){e.Pick="",e.Omit="!",e.Prefix="^",e.Suffix="$",e.Filter="?",e.Index="index"}(y||(y={}));var m=function(e){this.raw=e,this.raw=e.trim();for(var t=0,n=0,o=0;o<e.length;o+=1){var s=e.charCodeAt(o);if(33===s||s>=60&&s<=62||94===s)0===t&&(t=o);else if(t>0){n=o;break}}var a=e.substring(t,n);if(0!==a.length){var u=this.raw.split(a);if(u.length>2)throw new Error(i.format(r.SelectorIncorrectTokenCount,u.length.toString(),e));if(2!==u.length)throw new Error(i.format(r.SelectorIncorrectTokenCount,u.length.toString(),e));this.name=u[0],this.value=u[1],this.operator="="===a||"==="===a?"==":a}else this.name=this.raw,this.value=null,this.operator=null},w=function(){function e(e){switch(this.raw=e,this.index=0,this.props=[],this.raw=e.trim(),this.raw[0]){case"(":if(")"!==this.raw[this.raw.length-1])throw new Error(i.format(r.SelectorMissingToken,")",e));this.kind=y.Pick,this.parseProps(this.raw.substring(1,this.raw.length-1));break;case"!":if("("!==this.raw[1])throw new Error(i.format(r.SelectorMissingToken,"(",e));if(")"!==this.raw[this.raw.length-1])throw new Error(i.format(r.SelectorMissingToken,")",e));this.kind=y.Omit,this.parseProps(this.raw.substring(2,this.raw.length-1));break;case"^":if("("!==this.raw[1])throw new Error(i.format(r.SelectorMissingToken,"(",e));if(")"!==this.raw[this.raw.length-1])throw new Error(i.format(r.SelectorMissingToken,")",e));this.kind=y.Prefix,this.parseProps(this.raw.substring(2,this.raw.length-1));break;case"$":if("("!==this.raw[1])throw new Error(i.format(r.SelectorMissingToken,"(",e));if(")"!==this.raw[this.raw.length-1])throw new Error(i.format(r.SelectorMissingToken,")",e));this.kind=y.Suffix,this.parseProps(this.raw.substring(2,this.raw.length-1));break;case"?":if("("!==this.raw[1])throw new Error(i.format(r.SelectorMissingToken,"(",e));if(")"!==this.raw[this.raw.length-1])throw new Error(i.format(r.SelectorMissingToken,")",e));this.kind=y.Filter,this.parseProps(this.raw.substring(2,this.raw.length-1));break;default:if(this.index=Number.parseInt(this.raw,10),Number.isNaN(this.index))throw new Error(i.format(r.SelectorInvalidIndex,this.index.toString(),e));this.kind=y.Index}this.propNames=this.props.map((function(e){return e.name}))}return e.prototype.parseProps=function(e){var t=this,n=e.trim();if(0===n.length)throw new Error(r.SelectorNoProps);n.split(",").forEach((function(e){t.props.push(new m(e))}))},e}(),b=function(e){if(this.raw=e,this.raw=this.raw.trim(),!1===this.raw.includes("["))throw new Error(i.format(r.SelectorMissingToken,"[",e));if(!1===this.raw.endsWith("]"))throw new Error(i.format(r.SelectorMissingToken,"]",e));var t=this.raw.split("[");if(2!==t.length)throw new Error(i.format(r.SelectorIncorrectTokenCount,t.length.toString(),e));this.prop=t[0],this.op=new w(t[1].substring(0,t[1].length-1))},E=function(){function e(t){this.raw=t,this.parsedInfo={},this.kind=e.sniffKind(t),this.parse()}return e.prototype.select=function(e){if(null!=e)switch(this.kind){case h.Pluck:return this.selectPluck(e);case h.Index:return this.selectIndex(e);case h.Pick:return this.selectPick(e);case h.Omit:return this.selectOmit(e);case h.Prefix:return this.selectPrefix(e);case h.Suffix:return this.selectSuffix(e);case h.Filter:return this.selectFilter(e);default:throw new Error(i.format(r.SelectorSyntaxUnsupported,this.kind))}},e.prototype.parse=function(){switch(this.kind){case h.Pluck:break;case h.Index:case h.Pick:case h.Omit:case h.Prefix:case h.Suffix:case h.Filter:this.brackets=new b(this.raw);break;default:throw new Error(i.format(r.SelectorSyntaxUnsupported,this.kind))}},e.prototype.selectPluck=function(e){return null===e?void 0:e[this.raw]},e.prototype.selectIndex=function(e){if(!this.brackets||this.brackets.op.kind!==y.Index)throw new Error(i.format(r.SelectorMissingToken,"[i]",this.raw));var t=e[this.brackets.prop];if(null!=t){var n=this.brackets.op.index;if(!(n>=t.length||(n<0&&(n=t.length+n),n<0)))try{return t[n]}catch(e){return}}},e.prototype.selectPick=function(e){if(!this.brackets||this.brackets.op.kind!==y.Pick)throw new Error(i.format(r.SelectorMissingToken,"[()]",this.raw));var t=e[this.brackets.prop];if(null!=t){var n={},o=!1;if(this.brackets.op.props.forEach((function(e){void 0!==t[e.name]&&(n[e.name]=t[e.name],o=!0)})),!1!==o)return n}},e.prototype.selectOmit=function(e){if(!this.brackets||this.brackets.op.kind!==y.Omit)throw new Error(i.format(r.SelectorMissingToken,"![()",this.raw));var t=e[this.brackets.prop];if(null!=t){for(var n={},o=!1,s=Object.getOwnPropertyNames(t),a=0;a<s.length;a+=1){var u=s[a];this.brackets.op.propNames.includes(u)||(n[u]=t[u],o=!0)}if(!1!==o)return n}},e.prototype.selectPrefix=function(e){if(!this.brackets||this.brackets.op.kind!==y.Prefix)throw new Error(i.format(r.SelectorMissingToken,"^[()]",this.raw));var t=e[this.brackets.prop];if(null!=t){for(var n={},o=!1,s=Object.getOwnPropertyNames(t),u=0;u<s.length;u+=1)for(var c=s[u],p=0;p<this.brackets.op.propNames.length;p+=1)if(a(c,this.brackets.op.propNames[p])){n[c]=t[c],o=!0;break}if(!1!==o)return n}},e.prototype.selectSuffix=function(e){if(!this.brackets||this.brackets.op.kind!==y.Suffix)throw new Error(i.format(r.SelectorMissingToken,"$[()]",this.raw));var t=e[this.brackets.prop];if(null!=t){for(var n={},o=!1,s=Object.getOwnPropertyNames(t),a=0;a<s.length;a+=1)for(var u=s[a],c=0;c<this.brackets.op.propNames.length;c+=1)if(u.endsWith(this.brackets.op.propNames[c])){n[u]=t[u],o=!0;break}if(!1!==o)return n}},e.prototype.selectFilter=function(e){if(!this.brackets||this.brackets.op.kind!==y.Filter)throw new Error(i.format(r.SelectorMissingToken,"?[()]",this.raw));var t=e[this.brackets.prop];if(null!=t){for(var n=0;n<this.brackets.op.props.length;n+=1){var o=this.brackets.op.props[n];if(void 0===t[o.name]&&"undefined"!==o.value)return;if(null!==o.value)switch(typeof t[o.name]){case"boolean":if(t[o.name]!==("true"===o.value.toLowerCase()))return;break;case"string":var s=o.value;if(o.value){var u=s.charAt(0),c=s.charAt(s.length-1);('"'===u&&'"'===c||"'"===u&&"'"===c)&&(s=s.substring(1,s.length-1))}if("=="===o.operator&&t[o.name]!=s)return;if("!="==o.operator&&t[o.name]==s)return;if("=^"===o.operator&&!a(t[o.name],s))return;if("!^"===o.operator&&a(t[o.name],s))return;break;case"number":if("=="===o.operator&&t[o.name]!=o.value)return;if("!="===o.operator&&t[o.name]==o.value)return;if(">="===o.operator&&t[o.name]<o.value)return;if("<="===o.operator&&t[o.name]>o.value)return;if(">"===o.operator&&t[o.name]<=o.value)return;if("<"===o.operator&&t[o.name]>=o.value)return;break;case"undefined":case"object":if("=="===o.operator&&null!=t[o.name])return;if("!="===o.operator&&null==t[o.name])return;break;default:throw new Error(i.format(r.SelectorSyntaxUnsupported,o.raw))}}return t}},e.sniffKind=function(e){if(0===e.length)throw new Error(i.format(r.SelectorMalformed,e));for(var t=Object.keys(g),n=0;n<t.length;n+=1){var o=t[n];if(g[o](e))return o}throw new Error(i.format(r.SelectorMalformed,e))},e}(),x=function(){function e(e){this.path=e,this.tokens=[],this.elements=[],this.path=e.trim();for(var t=!1,r="",n=0;n<this.path.length;n+=1)"."!==this.path[n]||t?(r+=this.path[n],"["===this.path[n]&&(t=!0),"]"===this.path[n]&&(t=!1)):(this.tokens.push(r),this.elements.push(new E(r)),r="");this.tokens.push(r),this.elements.push(new E(r))}return e.prototype.select=function(e){for(var t=e,r=0;r<this.elements.length;r+=1)if(void 0===(t=this.elements[r].select(t)))return;return t},e}();function O(e){if(void 0===v[e])try{v[e]=new x(e)}catch(t){v[e]=!1}return v[e]}function k(e,t){var r=O(e);if(!1!==r)return r.select(t||s())}var S,P=function(){function e(e){this.options=e}return e.prototype.handleData=function(e){var t=this.options,r=t.func,n=t.thisArg,o=s();if(n)switch(typeof n){case"object":o=n;break;case"string":o=k(n);break;default:throw new Error("Unsupported this context used")}if(!o)throw new Error("No this context set");var i=null;switch(typeof r){case"function":return null==(i=r.apply(o,e))?null:[i];case"string":return null==(i=k(r).apply(o,e))?null:[i];default:return null}},e.prototype.validate=function(){new p(this.options).validate(e.specification)},e.specification={func:{required:!0,type:["string","function"]},thisArg:{required:!1,type:["string","object"]}},e}(),j=function(){function e(e){this.options=e;var t=e.index,r=void 0===t?0:t,n=e.properties,o=void 0===n?[]:n;this.index=r,this.properties="string"==typeof o?o.split(",").map((function(e){return e.trim()})):o}return e.prototype.handleData=function(e){var t=e[this.index];if("object"!=typeof t&&!1===Array.isArray(t))throw new Error("Can only fan out arrays or properties on objects");var r=[];if(0===this.properties.length)return Array.isArray(t)?r.push.apply(r,t):Object.values(t).forEach((function(e){Array.isArray(e)?r.push.apply(r,e):"object"==typeof e&&r.push(e)})),r;for(var n=0;n<this.properties.length;n+=1){var o=t[this.properties[n]];Array.isArray(o)?r.push.apply(r,o):r.push(o)}return r},e.prototype.validate=function(){new p(this.options).validate(e.specification)},e.specification={index:{required:!1,type:["number"]},properties:{required:!1,type:["string"]}},e}(),D=function(){function e(e){this.options=e;var t=e.index,r=void 0===t?0:t,n=e.position,o=void 0===n?0:n;this.index=r,this.position=o}return e.prototype.handleData=function(e){var t=this.options,r=t.defaultValue,n=t.select,o=t.value;if(n&&void 0!==o)throw new Error("Both 'select' and 'value' options set");var i=o||k(n,e[this.index]);if(void 0===i&&void 0!==r&&(i=r),void 0===i)throw new Error("Failed to find a value to insert");var s=e.slice();return s.splice(this.position>=0?this.position:s.length-this.position,0,i),s},e.prototype.validate=function(){var t=new p(this.options);t.validate(e.specification);var r=this.options,n=r.select,o=r.value;n||void 0!==o||t.throwError("selection"," and 'value' are missing - at least one is required"),n&&void 0!==o&&t.throwError("selection"," and 'value' are both defined - use only one option")},e.specification={defaultValue:{required:!1,type:["boolean,string,number,object"]},index:{required:!1,type:["number"]},select:{required:!1,type:["string"]},value:{required:!1,type:["boolean,string,number,object"]},position:{required:!1,type:["number"]}},e}();!function(e){e.Bool="_bool",e.Bools="_bools",e.Date="_date",e.Dates="_dates",e.Int="_int",e.Ints="_ints",e.Obj="_obj",e.Objs="_objs",e.String="_str",e.Strings="_strs",e.Real="_real",e.Reals="_reals"}(S||(S={}));var _=function(){function e(t){this.options=t;var r=t.index,n=void 0===r?-1:r,o=t.maxDepth,i=void 0===o?10:o,s=t.maxProps,a=void 0===s?e.DefaultMaxProps:s;this.index=n,this.maxDepth=i,this.maxProps=a,this.maxProps>=e.MaxPropsCeiling&&this.validate()}return e.coerceNumSuffix=function(){return S.Real},e.coerceSuffix=function(t){if(void 0===t)return null;if(Array.isArray(t))return t.every((function(e){return"string"==typeof e}))?S.Strings:t.every((function(e){return"boolean"==typeof e}))?S.Bools:t.every((function(e){return"number"==typeof e}))?S.Reals:t.every((function(e){return e instanceof Date}))?S.Dates:t.every((function(e){return"object"==typeof e}))?S.Objs:null;if(t instanceof Date)return S.Date;switch(typeof t){case"string":return S.String;case"boolean":return S.Bool;case"number":return e.coerceNumSuffix();case"object":return S.Obj;default:return null}},e.prototype.mapToSuffix=function(t,r,n){var o=this;void 0===r&&(r=0),void 0===n&&(n=0);var i={};if(null==t)return i;var s=n+Object.getOwnPropertyNames(t).reduce((function(e,r){return void 0!==t[r]?e+1:e}),0);if(s>this.maxProps)throw Error("Number of object properties exceeds the limit ("+this.maxProps+"); increase maxProps to "+s);return Object.getOwnPropertyNames(t).forEach((function(n){var a=t[n],u=0!==r||"pageName"!==n&&"displayName"!==n&&"email"!==n?e.coerceSuffix(a):"",c=""+n+u;if(null!==u)switch(u){case S.Obj:r<o.maxDepth&&(i[c]=o.mapToSuffix(a,r+1,s));break;case S.Objs:r<o.maxDepth&&(i[c]=a.map((function(e){return o.mapToSuffix(e,r+1,s)})));break;default:i[c]=a}})),i},e.prototype.handleData=function(e){var t=this.index>=0?this.index:e.length+this.index;return"string"==typeof e[t]&&(t-=1),"object"!=typeof e[t]?null:l(e,t,this.mapToSuffix(e[t]))},e.prototype.validate=function(){var t=new p(this.options);t.validate(e.specification);var r=this.options.maxProps;void 0!==r&&r>=e.MaxPropsCeiling&&t.throwError("maxProps","exceeds the FullStory limit ("+e.MaxPropsCeiling+"), use a lower value")},e.specification={index:{required:!1,type:["number"]},maxDepth:{required:!1,type:["number"]},maxProps:{required:!1,type:["number"]}},e.DefaultMaxProps=100,e.MaxPropsCeiling=5e3,e}(),I=function(){function e(e){this.options=e;var t=e.index,r=void 0===t?0:t,n=e.properties,o=void 0===n?{}:n;this.index=r,this.properties=o}return e.prototype.handleRename=function(e){for(var t=Object.getOwnPropertyNames(this.properties),r=0;r<t.length;r+=1){var n=t[r],o=this.properties[n],i=e[n];delete e[n],e[o]=i}},e.prototype.handleData=function(e){if("object"!=typeof e[this.index])throw new Error("Can only convert property names on objects");var t=c({},e[this.index]);return this.handleRename(t),l(e,this.index,t)},e.prototype.validate=function(){var t=new p(this.options);t.validate(e.specification);var r=this.options.properties;0===Object.getOwnPropertyNames(r).length&&t.throwError("properties","at least one property must be renamed");for(var n=Object.getOwnPropertyNames(r),o=0;o<n.length;o+=1)"string"!=typeof r[n[o]]&&t.throwError("properties","can only rename to string values")},e.specification={index:{required:!1,type:["number"]},properties:{required:!0,type:["object"]}},e}(),N=function(){function e(e){this.options=e;var t=e.index,r=void 0===t?0:t;this.index=r}return e.prototype.handleData=function(e){var t=k(this.options.select,{$:e[this.index]});return null==t?null:[t]},e.prototype.validate=function(){var t=new p(this.options);t.validate(e.specification),"$"!==this.options.select.charAt(0)&&t.throwError("select","must begin with $")},e.specification={index:{required:!1,type:["number"]},select:{required:!0,type:["string"]}},e}(),T=function(){function e(){}return e.create=function(t,n){if(!e.hasOperator(t))throw new Error(i.format(r.UnknownValue,t));return new this.operators[t](n)},e.hasOperator=function(e){return void 0!==this.operators[e]},e.operators={convert:f,flatten:d,function:P,insert:D,suffix:_,query:N,rename:I,"fan-out":j},e}(),M=function(e,t,r){this.path=e,this.property=t,this.args=r},R=function(e,t,r){this.path=e,this.property=t,this.value=r};function A(e,t){return"datalayerobserver/"+e+"/"+t}var q="dlo_init_span",C="dlo_rule_collection_span",U="dlo_rule_registration_span",$="dlo_handle_event_span",F="dlo_client_error",L="dlo_operator_error",V="dlo_monitor_removal_error",z="dlo_monitor_call_error",B="dlo_monitor_emit_error",W="dlo_observer_read_error",H="dlo_invalid_rule_error",J="dlo_rule_registration_error",G="dlo_observer_init_error",K={version:"3.0.0"},Q=function(){function e(t,r,n){this.name=t,this.sendSpan=r,this.attributes=n,this.startTime=e.getCurrentTime()}return e.prototype.end=function(){try{var t=e.getCurrentTime()-this.startTime;if(t<0||Number.isNaN(t))return void i.getInstance().debug("ignoring span, calculated an invalid duration: "+t);this.sendSpan({name:this.name,timestamp:(new Date).toISOString(),attributes:this.attributes,duration:t})}catch(e){i.getInstance().debug("Error sending telemetry span: "+e.message)}},e.getCurrentTime=function(){return window.performance&&window.performance.now()||(new Date).getTime()},e}(),X=function(){function e(e){this.exporter=e,this.defaultAttributes={}}return e.prototype.startSpan=function(e,t){try{return new Q(e,this.exporter.sendSpan,this.mergeWithDefaultAttributes(t))}catch(e){return i.getInstance().debug("Error starting telemetry span: "+e.message),{end:function(){}}}},e.prototype.count=function(e,t,r){try{this.exporter.sendCount({name:e,timestamp:(new Date).toISOString(),attributes:this.mergeWithDefaultAttributes(r),value:t})}catch(e){i.getInstance().debug("Error sending telemetry count: "+e.message)}},e.prototype.withDefaultAttributes=function(e){return this.defaultAttributes=e,this},e.prototype.mergeWithDefaultAttributes=function(e){return c(c({},this.defaultAttributes),e)},e}(),Y={sendSpan:function(e){console.debug("Telemetry Span",e)},sendCount:function(e){console.debug("Telemetry Count",e)}},Z={sendSpan:function(){},sendCount:function(){}},ee=function(){function e(){}return e.setProvider=function(t){e.instance=t},e.withExporter=function(e){return new X("console"===e?Y:e&&"string"!=typeof e?e:Z)},e.getInstance=function(){return e.instance||(e.instance=e.withExporter(Z)),e.instance},e.startSpan=function(t,r){return e.getInstance().startSpan(t,r)},e.count=function(t,r,n){e.getInstance().count(t,r,n)},e.error=function(t){e.count(F,1,{errorType:t})},e}(),te=function(){function e(t,n,o,i){if(void 0===o&&(o=!1),void 0===i&&(i=e.DefaultDebounceTime),this.source=t,this.target=n,this.debug=o,this.debounce=i,this.listener=null,this.operators=[],this.timeoutId=null,this.debugger=function(e,t,r){return console.debug(t?""+r+e+"\n"+r+JSON.stringify(t):""+r+e)},!n||!n.value)throw new Error(r.DataLayerMissing);this.start()}return e.prototype.fireEvent=function(e){void 0===e&&(e=this.target.query()),e&&this.handleData([e])},e.prototype.handleEvent=function(e){var r=this,n=e.detail,o=n.args,s=n.value,a=e.type,u=this.target.path;if(void 0===s&&void 0===o)i.getInstance().debug(t.EventEmpty,{path:u});else if(a===A(this.source,u))if(void 0!==s){"number"==typeof this.timeoutId&&window.clearTimeout(this.timeoutId);var c=this.target.query();c&&(this.timeoutId=window.setTimeout((function(){r.timeoutId=null,r.handleData([c])}),this.debounce))}else this.handleData(o||[]);else i.getInstance().warn(t.EventUnexpected,{path:u})},e.prototype.handleData=function(r,n){void 0===n&&(n=0);var o=ee.startSpan($,{operatorCount:this.operators.length,operatorNames:this.operators.map((function(e){return e.options.name})).join(",")}),s=this.target.path;this.runDebugger(s+" handleData entry",r);for(var a=r,u=n;u<this.operators.length;u+=1){var c=this.operators[u].options.name;try{if(null===a||e.isEmptyData(a))return this.runDebugger("["+u+"] "+c+" halted",a,"  "),null;if(null!==(a=this.operators[u].handleData(a))&&this.operators[u]instanceof j){for(var p=0;p<a.length;p+=1)this.handleData([a[p]],u+1);break}var l="";if(this.debug&&null!==a&&null!==a[0]&&"object"==typeof a[0]){var h=a[0];l="(numKeys="+e.numProperties(h)+" sizeOfValues="+e.sizeOfValues(h)+" sizeOfPayload="+e.sizeOfPayload(h)+")"}this.runDebugger("["+u+"] "+c+" output "+l,a,"  ")}catch(e){return i.getInstance().error(t.OperatorError,{operator:c,path:s,reason:e.message}),ee.error(L),null}}return this.runDebugger(s+" handleData exit",a),o.end(),a},e.isEmptyData=function(e){for(var t=function(t){var r=e[t];return"object"!=typeof r||null!==r&&Object.keys(r).some((function(e){return void 0!==r[e]}))?{value:!1}:void 0},r=0;r<e.length;r+=1){var n=t(r);if("object"==typeof n)return n.value}return!0},e.sizeOfPayload=function(e,t){return void 0===t&&(t=2),JSON.stringify(e).length*t},e.sizeOfValues=function(e,t){var r=this;void 0===t&&(t=2);var n=0;return"object"==typeof e&&Object.getOwnPropertyNames(e).forEach((function(o){switch(typeof e[o]){case"object":null==e[o]||Array.isArray(e[o])||(n+=r.sizeOfValues(e[o]));break;case"string":n+=e[o].length*t;break;case"number":n+=8;break;case"boolean":n+=2}})),n},e.numProperties=function(e){var t=this,r=0;return"object"==typeof e&&Object.getOwnPropertyNames(e).forEach((function(n){"object"!=typeof e[n]||null==e[n]||Array.isArray(e[n])?r+=1:r+=t.numProperties(e[n])})),r},e.prototype.runDebugger=function(e,t,r){void 0===r&&(r=""),this.debug&&this.debugger(e,t,r)},e.prototype.push=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.forEach((function(t){return e.operators.push(t)}))},e.prototype.start=function(){var e=this;this.listener||(this.listener=function(t){return e.handleEvent(t)},window.addEventListener(A(this.source,this.target.path),this.listener))},e.prototype.stop=function(){window.removeEventListener(A(this.source,this.target.path),this.listener),this.listener=null},e.DefaultDebounceTime=250,e}(),re=function(){function e(e,t,n,o){if(void 0===o&&(o=""),this.subject=e,this.property=t,this.path=n,this.selector=o,"object"!=typeof e)throw new Error(r.TargetSubjectObject);if(!t)throw new Error(r.TargetPropertyMissing);if(!n)throw new Error(r.TargetPathMissing);var s=typeof(this.selector?k(this.path):this.subject[this.property]);switch(s){case"object":case"function":this.type=s;break;default:i.getInstance().warn(r.UnsupportedType,{path:n,property:t,selector:o})}}return Object.defineProperty(e.prototype,"subjectPath",{get:function(){return this.path.substring(0,this.path.lastIndexOf("."))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return k(this.path)||this.subject[this.property]},enumerable:!1,configurable:!0}),e.prototype.query=function(){return this.selector?k(this.selector):this.value},e.find=function(t){var n=O(t);if(!n)throw new Error(i.format(r.SelectorMalformed,t));for(var o="",a="",u="",c=n.elements,p=0;p<c.length;p+=1){var l=c[p],f=l.kind,d=l.raw,v=l.brackets;if(f!==h.Pluck&&f!==h.Index){if(v){a=t.substring(0,t.indexOf("["+v.op.raw+"]")),u=v.prop;break}throw new Error("Brackets expected in "+d+" but not found")}o+=o?"."+d:d,a+=a?"."+d:d,u=v?v.prop:d}return o===a&&(o=o.substring(0,o.lastIndexOf("."))),new e(o?k(o):s(),u,a,t)},e}(),ne=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.configurable=!0,t.enumerable=!0,t.writable=!0,t}return function(e,t){function r(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(n,e),n.checkShimAllowed=function(e){if(Object.isFrozen(e))throw new Error(i.format(r.ShimFail,"frozen"));if(Object.isSealed(e))throw new Error(i.format(r.ShimFail,"sealed"))},n.prototype.addPropertyMonitor=function(){var e=this;n.checkShimAllowed(this.object);var t=Object.getOwnPropertyDescriptor(this.object,this.property);if(t){var r=t.configurable,o=t.enumerable,i=t.writable;this.configurable=r,this.enumerable=o,this.writable=i}Object.defineProperty(this.object,this.property,{configurable:this.configurable,enumerable:this.enumerable,get:function(){return e.state},set:function(t){var r=e.state!==t;e.state=t,r&&e.emit(t)}})},n.prototype.remove=function(){try{Object.defineProperty(this.object,this.property,{enumerable:this.enumerable,configurable:this.configurable,value:this.state,writable:this.writable}),this.sources.clear()}catch(e){i.getInstance().error(t.MonitorRemoveError,{path:this.path,property:this.property,reason:e.message}),ee.error(V)}},n.prototype.addFunctionMonitor=function(){var e=this;n.checkShimAllowed(this.object),this.object[this.property]=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];try{return e.emit(r),e.state.apply(e.object,r)}catch(r){return i.getInstance().error(t.MonitorCallError,{path:e.property,property:e.property,reason:r.message}),ee.error(z),null}}},n}(function(){function e(e,n,o,s){if(this.object=n,this.property=o,this.path=s,this.sources=new Set,!n)throw new Error(r.DataLayerMissing);if(s.endsWith(o)&&"function"!=typeof n[o]&&i.getInstance().warn(t.MonitorDuplicateProp,{path:s,property:o}),this.copy(),"object"!=typeof n&&"function"!=typeof n[o])throw new Error(i.format(r.UnsupportedType,typeof n));"function"==typeof n[o]?this.addFunctionMonitor():this.addPropertyMonitor(),this.sources.add(e)}return e.prototype.addSource=function(e){this.sources.add(e)},e.prototype.copy=function(){this.state=this.object[this.property]},e.prototype.emit=function(e){var r=this;try{this.sources.forEach((function(t){window.dispatchEvent(function(e,t,r,n,o){return new CustomEvent(A(e,o),{detail:"function"==typeof t[r]?new M(o,r,n):new R(o,r,n)})}(t,r.object,r.property,e,r.path))}))}catch(e){i.getInstance().error(t.MonitorEmitError,{path:this.path,property:this.property,reason:e.message}),ee.error(B)}},e}()),oe=function(){function e(){this.monitors={}}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.create=function(e,t,r,n){var o="function"==typeof t[r]?n:n+"."+r;if(this.monitors[o])this.monitors[o].addSource(e);else{var i=Object.getOwnPropertyDescriptor(t,r)||null;(null===i||i.configurable)&&(this.monitors[o]=new ne(e,t,r,n))}return this.monitors[o]},e.prototype.remove=function(e,t){var r=this;void 0===t&&(t=!1),(t?Object.getOwnPropertyNames(this.monitors).filter((function(t){return a(t,e)})):[e]).forEach((function(e){var t=r.monitors[e];t&&(t.remove(),delete r.monitors[e])}))},e}(),ie=function(){function e(e){var t=this;void 0===e&&(e={rules:[],previewMode:!1,previewDestination:"console.log",readOnLoad:!1,validateRules:!0}),this.config=e,this.customOperators={},this.handlers=[],this.listeners={};var r=e.appender,n=e.logLevel,o=e.rules;if(r&&("string"==typeof r?i.getInstance(r):i.getInstance().appender=r),void 0!==n&&(i.getInstance().level=n),o&&o.length>0){var s=ee.startSpan(U,{ruleCount:o.length});o.forEach((function(e){return t.registerRule(e)})),s.end()}}return e.prototype.addHandler=function(e,t,r,n){void 0===r&&(r=!1),void 0===n&&(n=te.DefaultDebounceTime);var o=new te(e,t,r,n);return this.handlers.push(o),o},e.prototype.addMonitor=function(e,t){var r=t.subject,n=t.property,o=t.subjectPath,i=t.path,s=t.selector;if("function"===t.type)oe.getInstance().create(e,r,n,i);else{s&&oe.getInstance().create(e,r,n,o);var a=t.value;Object.getOwnPropertyNames(t.query()).forEach((function(t){oe.getInstance().create(e,a,t,i)}))}},e.prototype.addOperators=function(e,r,n){var o=this,s=this.config,a=s.beforeDestination,u=s.previewDestination,c=void 0===u?"console.log":u,p=s.previewMode;try{if(r.forEach((function(t){e.push(o.getOperator(t))})),a)(Array.isArray(a)?a:[a]).forEach((function(t){return e.push(o.getOperator(t))}));var l=p?c:n;e.push(new P({name:"function",func:l}))}catch(n){throw this.removeHandler(e),i.getInstance().error(t.OperatorError,{operator:JSON.stringify(r)}),ee.error(L),n}},e.prototype.getOperator=function(e){try{var r=e.name,n=this.customOperators[r]?this.customOperators[r]:T.create(r,e);return this.config.validateRules&&n.validate(),n}catch(r){throw i.getInstance().error(t.OperatorError,{operator:JSON.stringify(e)}),ee.error(L),r}},e.prototype.isUrlValid=function(e){var t=this.config.urlValidator;return t?t(e):!e||RegExp(e).test(window.location.href)},e.prototype.registerTarget=function(e,r,n,o,s,a,u,c){void 0===s&&(s=!1),void 0===a&&(a=!0),void 0===u&&(u=!1),void 0===c&&(c=te.DefaultDebounceTime);var p=r,l=p.value;a&&Array.isArray(l)&&(l.push&&l.unshift?(this.registerTarget(e,re.find(r.path+".unshift"),n,o,!1,!0,u,c),p=re.find(r.path+".push")):i.getInstance().warn(t.MonitorCreateError,{path:p.path,property:p.property,selector:p.selector,reason:"Browser does not support push and unshift"}));var h=this.addHandler(e,p,!!u,c);if(this.addOperators(h,n,o),s)if(Array.isArray(l))for(var f=0;f<l.length;f+=1)try{h.fireEvent(l[f])}catch(e){i.getInstance().error(t.ObserverReadError,{path:p.path,property:p.property,selector:p.selector,reason:e.message}),ee.error(W)}else if("object"===p.type)try{h.fireEvent()}catch(e){i.getInstance().error(t.ObserverReadError,{path:p.path,property:p.property,selector:p.selector,reason:e.message}),ee.error(W)}if(a||"function"===p.type)try{this.addMonitor(e,p)}catch(e){i.getInstance().warn(t.MonitorCreateError,{path:p.path,property:p.property,selector:p.selector,reason:e.message})}return h},e.prototype.sleep=function(e,t,r,n,o,i){var s=this;if(void 0===n&&(n=5),void 0===o&&(o=1),void 0===i&&(i=250),o>n)r();else if(e())t();else{var a=Math.pow(2,o-1)*i+Math.random();setTimeout((function(){s.sleep(e,t,r,n,o+1,i)}),a)}},e.prototype.registerRule=function(n){var o=this,s=this.config.readOnLoad,a=n.id,u=void 0===a?"":a,c=n.debounce,p=n.debug,l=n.source,h=n.operators,f=void 0===h?[]:h,d=n.destination,v=n.readOnLoad,y=n.url,g=n.monitor,m=void 0===g||g,w=n.waitUntil,b=void 0===w?e.DefaultWaitUntil:w,E=void 0===v?s:v;if(!l||!d)return i.getInstance().error(t.RuleInvalid,{rule:u,source:l,reason:"Missing "+(l?"destination":"source")}),void ee.error(H);if(this.isUrlValid(y))try{var x=function(){var e=re.find(l);o.registerTarget(l,e,f,d,E,m,p,c)},O=n.maxRetry,k=void 0===O?5:O;switch(typeof b){case"number":setTimeout((function(){x()}),b>-1?b:0);break;case"function":this.sleep((function(){return b(re.find(l))}),x,(function(){return i.getInstance().warn(t.RuleRegistrationError,{rule:u,source:l,reason:"Max Retries Attempted"})}),k);break;default:i.getInstance().warn(i.format(r.UnsupportedType,typeof b))}}catch(e){i.getInstance().warn(t.RuleRegistrationError,{rule:u,source:l,reason:e.message})}},e.prototype.registerOperator=function(e,t){if(T.hasOperator(e)||this.customOperators[e])throw new Error(i.format(r.DuplicateValue,e));this.customOperators[e]=t},e.prototype.removeHandler=function(e){e.stop();var t=this.handlers.indexOf(e);t>-1&&this.handlers.splice(t,1)},e.DefaultWaitUntil=function(e){var t=e.value;if(void 0===t&&("object"!=typeof t||"function"!=typeof t))return!1;if("object"==typeof t){var r=e.query();return void 0!==r&&Object.getOwnPropertyNames(r).length>0}return!0},e}();!function(){try{var e=window;i.getInstance(e._dlo_appender),e._dlo_telemetryProvider?ee.setProvider(e._dlo_telemetryProvider):ee.setProvider(ee.withExporter(e._dlo_telemetryExporter).withDefaultAttributes(K));var r=ee.startSpan(q);if(e._dlo_observer)return void i.getInstance().warn(t.ObserverMultipleLoad);var n=function(){try{var e=ee.startSpan(C),r=[];return Object.getOwnPropertyNames(window).forEach((function(e){if(!1!==a(e,"_dlo_rules")){var n=window[e];!1!==Array.isArray(n)?n.forEach((function(e){r.push(e)})):i.getInstance().warn(t.RuleInvalid,{property:n,reason:"Rules list must be an array"})}})),e.end(),r}catch(e){return i.getInstance().error(t.RuleRegistrationError,{reason:"Error: "+e}),ee.error(J),[]}}();0===n.length&&i.getInstance().warn(t.ObserverRulesNone),e._dlo_observer=new ie({appender:e._dlo_appender||void 0,beforeDestination:e._dlo_beforeDestination||void 0,logLevel:e._dlo_logLevel,previewMode:!0===e._dlo_previewMode,previewDestination:e._dlo_previewDestination||void 0,readOnLoad:!0===e._dlo_readOnLoad,validateRules:!0===e._dlo_validateRules,urlValidator:e._dlo_urlValidator||void 0,rules:n}),r.end()}catch(e){i.getInstance().error(t.ObserverInitializationError,{reason:"Error: "+e}),ee.error(G)}}()}();
